package com.aicareer.core.service.ParserOfVacancy;

import chat.giga.client.GigaChatClient;
import com.aicareer.core.model.FinalVacancyRequirements;
import com.aicareer.core.model.RealVacancy;
import com.aicareer.core.model.SelectedPotentialVacancy;
import com.aicareer.core.model.UserPreferences;
import com.aicareer.module.parsing.SelectOfVacancy;
import java.util.List;
import com.aicareer.core.service.gigachat.GigaChatService;
import java.util.Scanner;

public class SelectVacancy implements SelectOfVacancy {
  Scanner scan = new Scanner(System.in);
  @Override
  public String analyzeUserPreference(UserPreferences infoAboutPerson) {
    String promtAnalyze = (infoAboutPerson + "Роль: Ты — опытный HR-аналитик и карьерный психолог. Твоя задача — проанализировать диалог с пользователем, составить его детальный психологический портрет и на его основе подобрать три наиболее подходящие профессии.\n"
        + "\n"
        + "Контекст:\n"
        + "Пользователь прошел сессию карьерного консультирования. Тебе нужно глубоко проанализировать его ответы, чтобы понять его истинные мотивы, предпочтения и на основе этого предложить конкретные вакансии.\n"
        + "\n"
        + "История диалога для анализа:\n"
        + "\n"
        + "text\n"
        + "%s\n"
        + "Задача: Проведи комплексный анализ, а затем подбери профессии.\n"
        + "\n"
        + "ЧАСТЬ 1: ДЕТАЛЬНЫЙ АНАЛИЗ ПОРТРЕТА\n"
        + "\n"
        + "Проведи анализ по следующим направлениям:\n"
        + "\n"
        + "Ключевые мотиваторы:\n"
        + "\n"
        + "Выяви 3-5 основных ценностей (например, свобода, мастерство, влияние, стабильность, служение).\n"
        + "\n"
        + "Определи, что его заряжает энергией в работе.\n"
        + "\n"
        + "Найди скрытые мотивы в его высказываниях.\n"
        + "\n"
        + "Отметь, какие достижения он считает значимыми.\n"
        + "\n"
        + "Профессиональные предпочтения:\n"
        + "\n"
        + "Определи предпочтительный тип работы: индивидуальная, командная или смешанная.\n"
        + "\n"
        + "Проанализируй отношение к темпу работы: динамичный, стабильный или переменный.\n"
        + "\n"
        + "Выяви уровень комфорта с риском и неопределенностью.\n"
        + "\n"
        + "Пойми желаемую роль в команде: исполнитель, координатор, лидер, эксперт.\n"
        + "\n"
        + "Сильные стороны и склонности:\n"
        + "\n"
        + "Составь список проявляющихся сильных качеств (например, аналитическое мышление, эмпатия, креативность).\n"
        + "\n"
        + "Определи когнитивные предпочтения: аналитик, творческий, практический.\n"
        + "\n"
        + "Выяви коммуникативные паттерны.\n"
        + "\n"
        + "Отметь способности к обучению и адаптации.\n"
        + "\n"
        + "Ограничения и избегания:\n"
        + "\n"
        + "Определи, какие условия работы демотивируют пользователя.\n"
        + "\n"
        + "Выяви потенциальные источники стресса.\n"
        + "\n"
        + "Найди упоминания о том, чего он хочет избежать (например, микроменеджмент, рутина).\n"
        + "\n"
        + "Отметь возможные карьерные антипаттерны.\n"
        + "\n"
        + "Карьерные амбиции:\n"
        + "\n"
        + "Сформулируйте ясные краткосрочные цели (1-2 года).\n"
        + "\n"
        + "Выяви долгосрочные карьерные устремления.\n"
        + "\n"
        + "Оцените готовность к обучению и развитию.\n"
        + "\n"
        + "Определите желаемый баланс работы и жизни.\n"
        + "\n"
        + "Сбор доказательной базы:\n"
        + "\n"
        + "Выбери 4-6 наиболее показательных цитат из диалога.\n"
        + "\n"
        + "Свяжи каждую ключевую характеристику портрета с конкретными высказываниями.\n"
        + "\n"
        + "Отметь противоречия или несоответствия в ответах.\n"
        + "\n"
        + "ЧАСТЬ 2: ПОДБОР ПРОФЕССИЙ\n"
        + "\n"
        + "На основе составленного психологического портрета подбери три наиболее релевантные профессии.\n"
        + "\n"
        + "Требования к подбору профессий:\n"
        + "\n"
        + "Каждая профессия должна быть конкретной (например, \"Python Backend Developer\", \"Product Manager\", \"UX/UI Designer\", \"Data Analyst\", \"Маркетолог-аналитик\").\n"
        + "\n"
        + "Обязательно укажи уровень опыта (Junior, Middle, Senior), если это уместно.\n"
        + "\n"
        + "Для каждой профессии дай обоснование, четко связав ее с выводами из анализа.\n"
        + "\n"
        + "Пример обоснования: \"Профессия Data Scientist хорошо подходит, так как выявлены сильные аналитические способности, стремление к работе с данными для решения практических задач и предпочтение проектной работы с элементами исследования, что соответствует вашим ключевым мотиваторам.\"\n"
        + "\n"
        + "Требования ко всему анализу:\n"
        + "\n"
        + "Будь максимально конкретным и опирайся на факты из диалога.\n"
        + "\n"
        + "Выявляй не только явные, но и имплицитные (скрытые) предпочтения.\n"
        + "\n"
        + "Сохраняй практическую направленность для подбора вакансий.\n"
        + "\n"
        + "Отмечай силу выраженности каждой характеристики.\n"
        + "\n"
        + "Формат вывода:\n"
        + "\n"
        + "ПСИХОЛОГИЧЕСКИЙ ПОРТРЕТ ДЛЯ ПОДБОРА ВАКАНСИЙ\n"
        + "\n"
        + "1. Ключевые мотиваторы:\n"
        + "\n"
        + "[Список с пояснениями и цитатами]\n"
        + "\n"
        + "2. Профессиональные предпочтения:\n"
        + "\n"
        + "[Список с пояснениями и цитатами]\n"
        + "\n"
        + "3. Сильные стороны и склонности:\n"
        + "\n"
        + "[Список с пояснениями и цитатами]\n"
        + "\n"
        + "4. Ограничения и избегания:\n"
        + "\n"
        + "[Список с пояснениями и цитатами]\n"
        + "\n"
        + "5. Карьерные амбиции:\n"
        + "\n"
        + "[Список с пояснениями и цитатами]\n"
        + "\n"
        + "6. Доказательная база (ключевые цитаты):\n"
        + "\n"
        + "\"[Цитата 1]\" - показывает [какую характеристику].\n"
        + "\n"
        + "\"[Цитата 2]\" - показывает [какую характеристику].\n"
        + "\n"
        + "... и т.д.\n"
        + "\n"
        + "ПОДБОР ПРОФЕССИЙ\n"
        + "\n"
        + "На основе анализа, вам наиболее подходят следующие три направления:\n"
        + "\n"
        + "Профессия 1 (Уровень, если применимо)\n"
        + "\n"
        + "Обоснование: [Развернутое объяснение, почему эта профессия идеально соответствует мотивам, предпочтениям и сильным сторонам из портрета].\n"
        + "\n"
        + "Профессия 2 (Уровень, если применимо)\n"
        + "\n"
        + "Обоснование: [Развернутое объяснение, связывающее профессию с анализом].\n"
        + "\n"
        + "Профессия 3 (Уровень, если применимо)\n"
        + "\n"
        + "Обоснование: [Развернутое объяснение, связывающее профессию с анализом].\n"
        + "после напиши  ::: и три вакансии через запятую\n");
    String gigachatAnswer = GigaChatService.sendMessage(promtAnalyze);
    return gigachatAnswer;
  }

  List<String> threeVacancy = analyzeUserPreference(infoAboutperson).split(":::");
  threeVacancy.remove(0);
  String stringOfThreeVacancy = threeVacancy.toString();
  List<String> listOfThreeVacany = List.of(stringOfThreeVacancy.split(","));

  @Override
  public String chosenVacancy(List<String> listOfThreeVacany) {
    System.out.println("Choose 1 of three");
    int chosenNumber = scan.nextInt();
    return listOfThreeVacany.get(chosenNumber);
  }

  @Override
  public String FormingByParsing(SelectedPotentialVacancy selectedVacancy) {
    List<RealVacancy> vacancies = ParserService.getVacancies("Java middle developer", "1", 10);
    String newPromt = "";
    for (int i = 0; i < Math.min(10, vacancies.size()); i++) {
      RealVacancy vacancy = vacancies.get(i);
      newPromt += (vacancy + "\n");

    }

    System.out.println(newPromt);
    return newPromt;
  }

  @Override
  public String FormingFinalVacancyRequirements(
      String newPromt) {
      String gigachatFinalReqirements = GigaChatService.sendMessage(newPromt);
    return gigachatFinalReqirements;
  }
}
